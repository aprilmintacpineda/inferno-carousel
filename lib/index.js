'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _inferno=require('inferno');require('./index.css');var _objectAssign=require('object-assign'),_objectAssign2=_interopRequireDefault(_objectAssign),_raf=require('raf'),_raf2=_interopRequireDefault(_raf);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Carousel=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));c.timeout=function(a,b){function c(){Date.now()-d>b?a():(0,_raf2.default)(c)}var d=Date.now();c()},c.simulateInfiniteScroll=function(a){c.carouselItemsList&&(c.carouselItemsList.style.transition='',a===c.props.children.length?(c.currentXPosition=c.carouselItemsList.clientWidth,c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)'):0>a&&(c.currentXPosition=c.carouselItemsList.clientWidth*c.props.children.length,c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)'))},c.nextItem=function(){return c.currentXPosition+=c.lastClientWidth,c.carouselItemsList.style.transition='transform 300ms',c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)',c.state.currentItemIndex+1},c.previousItem=function(){return c.currentXPosition-=c.lastClientWidth,c.carouselItemsList.style.transition='transform 300ms',c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)',c.state.currentItemIndex-1},c.scrollTo=function(a){c.shouldNotAutoPlay=!0,c.stopCarousel(),c.currentXPosition=c.lastClientWidth*(a+1),c.carouselItemsList.style.transition='transform 300ms',c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)',c.state.currentItemIndex===a?c.playCarousel():c.setState({currentItemIndex:a},c.playCarousel)},c.switchCurrentItem=function(){if(c.shouldNotAutoPlay)c.stopCarousel();else{c.moving=!0;var a=c.nextItem();c.setState({currentItemIndex:a===c.props.children.length?0:a},function(){return c.timeout(function(){c.carouselItemsList&&c.simulateInfiniteScroll(a),c.moving=!1},310)})}},c.stopCarousel=function(){c.rafId&&(c.shouldNotAutoPlay=!0,_raf2.default.cancel(c.rafId))},c.playCarousel=function(){c.stopCarousel(),c.shouldNotAutoPlay=!1,c.lastTime=Date.now();var a=function(){3e3<=Date.now()-c.lastTime&&(c.switchCurrentItem(),c.lastTime=Date.now()),c.rafId=(0,_raf2.default)(a)};a()},c.resolveX=function(a){return a instanceof MouseEvent?a.clientX:a.changedTouches[0].clientX||a.changedTouches[0].pageX},c.touchstart=function(a){c.stopCarousel(),c.shouldNotAutoPlay=!0,a instanceof MouseEvent?(c.touchTarget.addEventListener('mousemove',c.touchmove),c.touchTarget.addEventListener('mouseup',c.touchend),c.touchTarget.addEventListener('mouseout',c.touchend)):(c.touchTarget.addEventListener('touchmove',c.touchmove),c.touchTarget.addEventListener('touchend',c.touchend)),c.touchDetection={started:!0,startX:c.resolveX(a),lastX:null,endX:null}},c.touchmove=function(a){if(!c.moving&&c.touchDetection.started){c.touchDetection=(0,_objectAssign2.default)(c.touchDetection,{endX:c.resolveX(a)});var b=c.currentXPosition+(c.touchDetection.startX-c.touchDetection.endX);c.carouselItemsList.style.transition='',c.carouselItemsList.style.transform='translate3d(-'+b+'px, 0, 0)'}},c.touchend=function(a){if(a instanceof MouseEvent?(c.touchTarget.removeEventListener('mousemove',c.touchmove),c.touchTarget.removeEventListener('mouseup',c.touchend),c.touchTarget.removeEventListener('mouseout',c.touchend)):(c.touchTarget.removeEventListener('touchmove',c.touchmove),c.touchTarget.removeEventListener('touchend',c.touchend)),!c.moving&&c.touchDetection.started){if(c.touchDetection=(0,_objectAssign2.default)(c.touchDetection,{endX:c.resolveX(a)}),!(100<=Math.abs(c.touchDetection.startX-c.touchDetection.endX)))c.carouselItemsList.style.transition='transform 300ms',c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)';else if(c.touchDetection.startX>c.touchDetection.endX){var b=c.nextItem();c.setState({currentItemIndex:b===c.props.children.length?0:b},function(){return c.timeout(function(){c.simulateInfiniteScroll(b)},301)})}else{var d=c.previousItem();c.setState({currentItemIndex:0>d?c.props.children.length-1:d},function(){return c.timeout(function(){c.simulateInfiniteScroll(d)},301)})}c.shouldNotAutoPlay=!1,c.timeout(c.playCarousel,3e3)}c.touchDetection={started:!1,startX:null,endX:null}},c.preventDrag=function(a){return a.preventDefault()},c.resized=function(){var a=function(){!c.carouselItemsList||c.moving?c.timeout(a,300):c.lastClientWidth!==c.carouselItemsList.clientWidth&&(c.resizing=!1,c.lastClientWidth=c.carouselItemsList.clientWidth,c.scrollTo(c.state.currentItemIndex))};c.stopCarousel(),c.timeout(a,0)},c.componentWillUnmount=function(){c.stopCarousel(),window.removeEventListener('resize',c.resized),c.touchTarget.removeEventListener('mousedown',c.touchstart),c.touchTarget.removeEventListener('dragstart',c.preventDrag),c.isTouchEnabledDevice&&c.touchTarget.removeEventListener('touchstart',c.touchstart)},c.componentDidMount=function(){window.addEventListener('resize',c.resized),c.playCarousel(),c.isTouchEnabledDevice&&c.touchTarget.addEventListener('touchstart',c.touchstart),c.touchTarget.addEventListener('mousedown',c.touchstart),c.touchTarget.addEventListener('dragstart',c.preventDrag),c.lastClientWidth=c.carouselItemsList.clientWidth,c.currentXPosition+=c.lastClientWidth,c.carouselItemsList.style.transform='translate3d(-'+c.currentXPosition+'px, 0, 0)'},c.render=function(){var a='carousel-container';return c.props.className&&(a+=' '+c.props.className),(0,_inferno.createVNode)(1,'div',a,[(0,_inferno.createVNode)(1,'div','carousel-item-list-wrapper',(0,_inferno.createVNode)(1,'div','carousel-item-list',c.carouselItems.map(function(a,b){return(0,_inferno.createVNode)(1,'div','carousel-item',a,0,null,b)}),0,null,null,function(a){c.carouselItemsList=a}),2,null,null,function(a){c.touchTarget=a}),(0,_inferno.createVNode)(1,'div','pagination',c.props.children.map(function(a,b){var d='clickable bullet';return b===c.state.currentItemIndex&&(d+=' active'),(0,_inferno.createVNode)(1,'span',d,null,1,{onClick:function a(){return c.scrollTo(b)}},b)}),0)],4)};var d=[].concat(c.props.children);return d.unshift(c.props.children[c.props.children.length-1]),d.push(c.props.children[0]),c.isTouchEnabledDevice=!!('ontouchstart'in window||window.DocumentTouch&&document instanceof window.DocumentTouch),c.resizing=!1,c.shouldNotAutoPlay=!1,c.currentXPosition=0,c.lastClientWidth=0,c.carouselItems=d,c.interval=null,c.moving=!1,c.touchDetection={started:!1,startX:null,endX:null},c.state={currentItemIndex:0},c}return _inherits(b,a),b}(_inferno.Component);exports.default=Carousel;